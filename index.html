<!DOCTYPE html>
<html>
<head>
    <title>Travel Itinerary Generator</title>
    <style>
        /* Add loading animation */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Travel AI Planner</h1>
        <textarea id="prompt" rows="4"></textarea>
        <button id="generateBtn" disabled>Generate Itinerary</button>
        <div id="output"></div>
    </div>

<script type="module">
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2/dist/transformers.min.js';

    let generator;
    let isGenerating = false;

    async function initializeModel() {
        try {
            document.getElementById('output').innerHTML = `
                <div class="loader"></div>
                <div>Downloading model (300MB)...</div>
            `;
            
            generator = await pipeline('text-generation', 'Xenova/distilgpt2', {
                quantized: true,
                progress_callback: (progress) => {
                    document.getElementById('output').innerHTML = `
                        <div class="loader"></div>
                        <div>Loading: ${Math.round(progress * 100)}%</div>
                    `;
                }
            });

            document.getElementById('generateBtn').disabled = false;
            document.getElementById('output').textContent = 'Ready!';
        } catch (error) {
            document.getElementById('output').textContent = `Error: ${error.message}`;
        }
    }

    async function generateItinerary() {
        if (isGenerating) return;
        
        try {
            isGenerating = true;
            const btn = document.getElementById('generateBtn');
            const output = document.getElementById('output');
            btn.disabled = true;
            output.innerHTML = `<div class="loader"></div>`;
            
            // Use setTimeout to keep UI responsive
            const prompt = document.getElementById('prompt').value;
            const runGeneration = () => new Promise(resolve => {
                setTimeout(async () => {
                    const result = await generator(prompt, {
                        max_new_tokens: 300,
                        temperature: 0.9,
                        do_sample: true
                    });
                    resolve(result);
                }, 0);
            });

            const response = await runGeneration();
            output.textContent = response[0].generated_text;
        } catch (error) {
            document.getElementById('output').textContent = `Error: ${error.message}`;
        } finally {
            isGenerating = false;
            document.getElementById('generateBtn').disabled = false;
        }
    }

    // Initialize with Web Worker for better performance
    if (window.Worker) {
        const worker = new Worker('worker.js');
        worker.onmessage = (e) => {
            document.getElementById('output').textContent = e.data;
        };
    }

    document.addEventListener('DOMContentLoaded', initializeModel);
    document.getElementById('generateBtn').addEventListener('click', generateItinerary);
</script>
</body>
</html>
