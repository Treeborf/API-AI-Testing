<!DOCTYPE html>
<html>
<head>
    <title>Language Translator</title>
    <style>
        /* Existing styles remain the same */
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Language Translator</h1>
        <textarea id="inputText" rows="4" placeholder="Enter text to translate..."></textarea>
        <button id="translateBtn" disabled>Translate</button>
        <div id="output"></div>
    </div>

<script type="module">
    import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2/dist/transformers.min.js';

    let translator;
    let isTranslating = false;

    async function initializeModel() {
        try {
            document.getElementById('output').innerHTML = `
                <div class="loader"></div>
                <div>Downloading translation model (~500MB)...</div>
            `;
            
            // Load a translation model (English to French in this example)
            translator = await pipeline('translation', 'Xenova/opus-mt-en-fr', {
                quantized: true,
                progress_callback: (progress) => {
                    document.getElementById('output').innerHTML = `
                        <div class="loader"></div>
                        <div>Loading: ${Math.round(progress * 100)}%</div>
                    `;
                }
            });

            document.getElementById('translateBtn').disabled = false;
            document.getElementById('output').textContent = 'Ready to translate!';
        } catch (error) {
            document.getElementById('output').textContent = `Error: ${error.message}`;
        }
    }

    async function translateText() {
        if (isTranslating) return;
        
        try {
            isTranslating = true;
            const btn = document.getElementById('translateBtn');
            const output = document.getElementById('output');
            btn.disabled = true;
            output.innerHTML = `<div class="loader"></div>`;
            
            const inputText = document.getElementById('inputText').value;
            const runTranslation = () => new Promise(resolve => {
                setTimeout(async () => {
                    const result = await translator(inputText, {
                        max_length: 400  // Adjust based on your needs
                    });
                    resolve(result);
                }, 0);
            });

            const response = await runTranslation();
            output.textContent = response[0].translation_text;
        } catch (error) {
            document.getElementById('output').textContent = `Error: ${error.message}`;
        } finally {
            isTranslating = false;
            document.getElementById('translateBtn').disabled = false;
        }
    }

    document.addEventListener('DOMContentLoaded', initializeModel);
    document.getElementById('translateBtn').addEventListener('click', translateText);
</script>
</body>
</html>
