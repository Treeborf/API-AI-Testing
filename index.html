<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>QnA Workaround Solution</title>
</head>
<body>
  <h1>Alternative QnA Implementation</h1>
  
  <textarea id="context" placeholder="Context..." rows="6" cols="60"></textarea><br>
  <input id="question" placeholder="Question..." size="60"><br>
  <button id="ask">Ask</button>
  <p id="answer"></p>

  <script type="module">
import { env, AutoTokenizer, AutoModelForQuestionAnswering } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@latest/dist/transformers.min.js';

// Initialize components
let tokenizer, model;
try {
  [tokenizer, model] = await Promise.all([
    AutoTokenizer.from_pretrained('Xenova/distilbert-base-cased-distilled-squad'),
    AutoModelForQuestionAnswering.from_pretrained('Xenova/distilbert-base-cased-distilled-squad')
  ]);
} catch (err) {
  document.getElementById('answer').textContent = `❌ Initialization failed: ${err.message}`;
}

document.getElementById('ask').addEventListener('click', async () => {
  const context = document.getElementById('context').value;
  const question = document.getElementById('question').value;

  try {
    // 1. Tokenize with correct format
    const inputs = await tokenizer(question, context, {
      padding: true,
      truncation: 'only_second',
      return_tensors: 'onnx' // Crucial for tensor format
    });

    // 2. Execute model
    const outputs = await model(inputs);
    
    // 3. Process logits correctly
    const startLogits = Array.from(outputs.start_logits.data);
    const endLogits = Array.from(outputs.end_logits.data);
    
    const startIdx = startLogits.indexOf(Math.max(...startLogits));
    const endIdx = endLogits.indexOf(Math.max(...endLogits)) + 1;

    // 4. Decode answer
    const answerTokens = inputs.input_ids.data.slice(startIdx, endIdx);
    const answer = await tokenizer.decode(answerTokens, { skip_special_tokens: true });
    
    document.getElementById('answer').textContent = `✅ Answer: ${answer}`;
  } catch (err) {
    console.error('Error breakdown:', {
      context: context?.slice(0, 50),
      question,
      error: err
    });
    document.getElementById('answer').textContent = 
      `❌ Error: ${err.message.split('\n')[0]}`;
  }
});
</script>

  <!-- Fallback message if WASM fails -->
  <noscript>
    <p style="color: red">JavaScript is required for this application.</p>
  </noscript>
</body>
</html>
