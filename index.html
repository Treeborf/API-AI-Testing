<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Transformers.js QA</title>
</head>
<body>
  <h1>Ask a Question (Transformers.js)</h1>

  <label for="context">üß† Context:</label><br>
  <textarea id="context" rows="6" cols="60" placeholder="Paste some context here..."></textarea><br><br>

  <label for="question">‚ùì Question:</label><br>
  <input id="question" type="text" size="60" placeholder="Type your question here..."><br><br>

  <button id="ask">Ask!</button>

  <p id="answer" style="margin-top: 20px; font-weight: bold;">Answer will appear here...</p>

  <script type="module">
  import { pipeline, AutoTokenizer } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2/dist/transformers.min.js';

  // Test tokenizer separately
  const tokenizer = await AutoTokenizer.from_pretrained("Xenova/distilbert-base-cased-distilled-squad");
  const testText = "Testing tokenizer";
  try {
    const encoded = tokenizer.encode(testText);
    console.log("Tokenizer test passed. Encoded output:", encoded);
  } catch (err) {
    console.error("Tokenizer test failed:", err);
  }

  const qa = await pipeline("question-answering", "Xenova/distilbert-base-cased-distilled-squad");

  document.getElementById("ask").addEventListener("click", async () => {
    const context = String(document.getElementById("context").value.trim());
    const question = String(document.getElementById("question").value.trim());
    const answerEl = document.getElementById("answer");

    if (!context || !question) {
      answerEl.textContent = "‚ö†Ô∏è Please fill out both context and question.";
      return;
    }

    // Type checks
    if (typeof question !== 'string' || typeof context !== 'string') {
      answerEl.textContent = "‚ùå Inputs must be strings.";
      return;
    }

    // Log input details
    console.log("QUESTION:", JSON.stringify(question), "TYPE:", typeof question);
    console.log("CONTEXT:", JSON.stringify(context), "TYPE:", typeof context);

    try {
      answerEl.textContent = "‚è≥ Thinking...";
      
      // Optional: Test with hard-coded values
      // const context = "Transformers.js is a JS library for NLP.";
      // const question = "What is Transformers.js?";

      const result = await qa({
        question: JSON.parse(JSON.stringify(question)),
        context: JSON.parse(JSON.stringify(context))
      });
      answerEl.textContent = `‚úÖ Answer: ${result.answer}`;
    } catch (err) {
      console.error("Pipeline error:", err);
      answerEl.textContent = "‚ùå Error. Check console.";
    }
  });
</script>
</body>
</html>
