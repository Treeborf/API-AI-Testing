<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Transformers.js QA</title>
</head>
<body>
  <h1>Ask a Question (Transformers.js)</h1>

  <label for="context">üß† Context:</label><br>
  <textarea id="context" rows="6" cols="60" placeholder="Paste some context here..."></textarea><br><br>

  <label for="question">‚ùì Question:</label><br>
  <input id="question" type="text" size="60" placeholder="Type your question here..."><br><br>

  <button id="ask">Ask!</button>

  <p id="answer" style="margin-top: 20px; font-weight: bold;">Answer will appear here...</p>

  <script type="module">
  // Test different versions (uncomment one)
  // Version 2.15.0 - Known stable for QA models
  import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.15.0/dist/transformers.min.js';
  
  // Version 2.16.0 - Alternative stable version
  // import { pipeline } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.16.0/dist/transformers.min.js';

  // Test different QA models (uncomment one)
  // const MODEL_NAME = "Xenova/distilbert-base-cased-distilled-squad"; // Original
  const MODEL_NAME = "Xenova/bert-base-uncased-squad2"; // Larger but more accurate
  // const MODEL_NAME = "Xenova/mobilebert-uncased-mnli"; // Mobile-optimized
  // const MODEL_NAME = "Xenova/albert-base-v2-squad2"; // Alternative architecture

  let qa;
  try {
    qa = await pipeline("question-answering", MODEL_NAME, {
      quantized: false, // Try with/without quantization
      progress_callback: (data) => {
        console.log(`Downloading ${data.file}: ${(data.progress * 100).toFixed(1)}%`);
      }
    });
    
    // Quick test of model with known input
    const testResult = await qa({
      question: "What is Transformers.js?",
      context: "Transformers.js is a JavaScript library that brings natural language processing capabilities to the browser."
    });
    console.log("Model test passed:", testResult.answer);
  } catch (err) {
    console.error("Model initialization failed:", err);
    document.getElementById("answer").textContent = 
      `‚ùå Failed to load ${MODEL_NAME}. Check console.`;
  }

  document.getElementById("ask").addEventListener("click", async () => {
    if (!qa) return;

    const context = String(document.getElementById("context").value.trim());
    const question = String(document.getElementById("question").value.trim());
    const answerEl = document.getElementById("answer");

    if (!context || !question) {
      answerEl.textContent = "‚ö†Ô∏è Please fill out both fields";
      return;
    }

    try {
      answerEl.textContent = "‚è≥ Thinking...";
      console.log("Input - Question:", question, "Context:", context.slice(0, 50) + "...");
      
      // Add timing and error context
      const start = performance.now();
      const result = await qa({ question, context });
      const duration = performance.now() - start;
      
      answerEl.textContent = `‚úÖ Answer (${duration.toFixed(0)}ms): ${result.answer}`;
      console.log("Full result:", result);
    } catch (err) {
      console.error("Runtime error:", {
        error: err,
        questionType: typeof question,
        contextType: typeof context,
        inputs: { question, context }
      });
      answerEl.textContent = `‚ùå Error: ${err.message.split('\n')[0]}`;
    }
  });
  </script>
</body>
</html>
