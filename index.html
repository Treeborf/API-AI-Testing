<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Transformers.js QA</title>
</head>
<body>
  <h1>Ask a Question (Transformers.js)</h1>

  <label for="context">üß† Context:</label><br>
  <textarea id="context" rows="6" cols="60" placeholder="Paste some context here..."></textarea><br><br>

  <label for="question">‚ùì Question:</label><br>
  <input id="question" type="text" size="60" placeholder="Type your question here..."><br><br>

  <button id="ask">Ask!</button>

  <p id="answer" style="margin-top: 20px; font-weight: bold;">Answer will appear here...</p>

  <script type="module">
  import { pipeline, AutoTokenizer } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@latest/dist/transformers.min.js';

  // Initialize with error handling
  let qa;
  try {
    [qa] = await Promise.all([
      pipeline("question-answering", "Xenova/distilbert-base-cased-distilled-squad"),
      (async () => {
        const tokenizer = await AutoTokenizer.from_pretrained("Xenova/distilbert-base-cased-distilled-squad");
        const testInputs = {
          question: "Test question",
          context: "Test context"
        };
        const encoded = tokenizer.encode(testInputs.question, testInputs.context);
        console.log("Tokenizer sanity check:", encoded);
      })()
    ]);
  } catch (err) {
    console.error("Initialization failed:", err);
    document.getElementById("answer").textContent = "‚ùå Initialization error. Check console.";
  }

  document.getElementById("ask").addEventListener("click", async () => {
    if (!qa) return;
    
    const context = String(document.getElementById("context").value.trim());
    const question = String(document.getElementById("question").value.trim());

    if (!context || !question) {
      answerEl.textContent = "‚ö†Ô∏è Please fill out both context and question.";
      return;
    }

    // Log input details
    console.log("QUESTION:", JSON.stringify(question), "TYPE:", typeof question);
    console.log("CONTEXT:", JSON.stringify(context), "TYPE:", typeof context);

    try {
      answerEl.textContent = "‚è≥ Thinking...";
      
      // Optional: Test with hard-coded values
      // const context = "Transformers.js is a JS library for NLP.";
      // const question = "What is Transformers.js?";

      const result = await qa({
        question: JSON.parse(JSON.stringify(question)),
        context: JSON.parse(JSON.stringify(context))
      });
      answerEl.textContent = `‚úÖ Answer: ${result.answer}`;
    } catch (err) {
      console.error("Pipeline error:", err);
      answerEl.textContent = "‚ùå Error. Check console.";
    }
  });
</script>
</body>
</html>
