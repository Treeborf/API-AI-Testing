<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Transformers.js QA</title>
</head>
<body>
  <h1>Ask a Question (Transformers.js)</h1>

  <label for="context">üß† Context:</label><br>
  <textarea id="context" rows="6" cols="60" placeholder="Paste some context here..."></textarea><br><br>

  <label for="question">‚ùì Question:</label><br>
  <input id="question" type="text" size="60" placeholder="Type your question here..."><br><br>

  <button id="ask">Ask!</button>

  <p id="answer" style="margin-top: 20px; font-weight: bold;">Answer will appear here...</p>

  <script>
    // Initialize pipeline outside event handler
    let qa;

    async function initializePipeline() {
      const { pipeline } = await import("https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2");
      qa = await pipeline("question-answering", "Xenova/distilbert-base-cased-distilled-squad");
    }

    // Initialize on window load
    window.addEventListener('load', async () => {
      try {
        await initializePipeline();
      } catch (error) {
        console.error('Pipeline initialization failed:', error);
      }
    });

    document.getElementById("ask").addEventListener("click", async () => {
      const context = document.getElementById("context").value.trim();
      const question = document.getElementById("question").value.trim();
      const answerEl = document.getElementById("answer");

      // Enhanced input validation
      if (!context || !question) {
        answerEl.textContent = "‚ö†Ô∏è Please fill out both context and question.";
        return;
      }

      // Verify string types explicitly
      if (typeof context !== 'string' || typeof question !== 'string') {
        answerEl.textContent = "‚ùå Invalid input types";
        return;
      }

      try {
        answerEl.textContent = "‚è≥ Thinking...";
        
        // Force string conversion
        const result = await qa({
          question: String(question),
          context: String(context)
        });
        
        answerEl.textContent = `‚úÖ Answer: ${result.answer}`;
      } catch (err) {
        console.error("Error details:", {
          questionType: typeof question,
          contextType: typeof context,
          error: err
        });
        answerEl.textContent = "‚ùå Processing error. Check console.";
      }
    });
  </script>
</body>
</html>




