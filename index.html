<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Transformers.js QA</title>
</head>
<body>
  <h1>Ask a Question (Transformers.js)</h1>

  <label for="context">üß† Context:</label><br>
  <textarea id="context" rows="6" cols="60" placeholder="Paste some context here..."></textarea><br><br>

  <label for="question">‚ùì Question:</label><br>
  <input id="question" type="text" size="60" placeholder="Type your question here..."><br><br>

  <button id="ask">Ask!</button>

  <p id="answer" style="margin-top: 20px; font-weight: bold;">Answer will appear here...</p>

  <script type="module">
    import { pipeline } from "https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2";

    // Initialize pipeline with proper configuration
    let qa;
    (async function init() {
      try {
        qa = await pipeline("question-answering", "Xenova/mobilebert-uncased-squad-v2", {
          quantized: true,  // Ensure model quantization
          progress_callback: (info) => console.log('Loading:', info)
        });
        console.log("Model loaded successfully");
      } catch (error) {
        console.error("Initialization error:", error);
      }
    })();

    document.getElementById("ask").addEventListener("click", async () => {
      const contextInput = document.getElementById("context");
      const questionInput = document.getElementById("question");
      const answerEl = document.getElementById("answer");

      // Enhanced input sanitization
      const context = String(contextInput.value).trim().normalize("NFKC");
      const question = String(questionInput.value).trim().normalize("NFKC");

      if (!context || !question) {
        answerEl.textContent = "‚ö†Ô∏è Please fill out both fields";
        return;
      }

      // Additional validation for empty strings after trimming
      if (context.length < 10 || question.length < 3) {
        answerEl.textContent = "‚ùå Inputs too short";
        return;
      }

      try {
        answerEl.textContent = "‚è≥ Processing...";
        
        // Verify pipeline readiness
        if (!qa) throw new Error("AI model not loaded yet");
        
        // Force string conversion and log inputs
        const sanitizedInputs = {
          question: question.slice(0, 500),  // Limit input length
          context: context.slice(0, 2000)
        };
        console.log("Processing inputs:", sanitizedInputs);

        const result = await qa(sanitizedInputs);
        answerEl.textContent = `‚úÖ Answer: ${result.answer}`;
      } catch (err) {
        console.error("Full error details:", {
          rawQuestion: questionInput.value,
          rawContext: contextInput.value,
          error: err
        });
        answerEl.textContent = "‚ùå Error - See console for details";
      }
    });

    import { GoogleGenAI } from "@google/genai";
    
    const ai = new GoogleGenAI({ apiKey: process.env.API_KEY });
    
    async function main() {
      const response = await ai.models.generateContent({
        model: "gemini-2.0-flash",
        contents: "Explain how AI works in a few words",
      });
      console.log(response.text);
    }
    
    await main();
        
  </script>
</body>
</html>




