<script type="module">
  import { pipeline, AutoTokenizer } from 'https://cdn.jsdelivr.net/npm/@xenova/transformers@2.17.2/dist/transformers.min.js';

  // Test tokenizer separately
  const tokenizer = await AutoTokenizer.from_pretrained("Xenova/distilbert-base-cased-distilled-squad");
  const testText = "Testing tokenizer";
  try {
    const encoded = tokenizer.encode(testText);
    console.log("Tokenizer test passed. Encoded output:", encoded);
  } catch (err) {
    console.error("Tokenizer test failed:", err);
  }

  const qa = await pipeline("question-answering", "Xenova/distilbert-base-cased-distilled-squad");

  document.getElementById("ask").addEventListener("click", async () => {
    const context = String(document.getElementById("context").value.trim());
    const question = String(document.getElementById("question").value.trim());
    const answerEl = document.getElementById("answer");

    if (!context || !question) {
      answerEl.textContent = "⚠️ Please fill out both context and question.";
      return;
    }

    // Type checks
    if (typeof question !== 'string' || typeof context !== 'string') {
      answerEl.textContent = "❌ Inputs must be strings.";
      return;
    }

    // Log input details
    console.log("QUESTION:", JSON.stringify(question), "TYPE:", typeof question);
    console.log("CONTEXT:", JSON.stringify(context), "TYPE:", typeof context);

    try {
      answerEl.textContent = "⏳ Thinking...";
      
      // Optional: Test with hard-coded values
      // const context = "Transformers.js is a JS library for NLP.";
      // const question = "What is Transformers.js?";

      const result = await qa({ question, context });
      answerEl.textContent = `✅ Answer: ${result.answer}`;
    } catch (err) {
      console.error("Pipeline error:", err);
      answerEl.textContent = "❌ Error. Check console.";
    }
  });
</script>
